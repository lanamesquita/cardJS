<!--
   Requisitos:
   - Criar um forms no GoogleForms para cadastrar as dicas de ética. Nesse cadastro tem um campo texto longo. OK
   - Investigar a quantidade de caracteres máximo do texto. -> 120
   - Criar um carrosel em html e javascript
   - Os textos devem ser atualizados a cada 2 minutos de forma randômica. Alterar a cor de fundo. Utilizar paleta com vários tons de azul.
   - Inserir carrosel na Intranet.
   -->
<meta charset="UTF-8">

<!-- CSS -->
<style type="text/css">
    body {
        width: 100%;
        height: 100%;
        margin: 0;
    }

    #blocoMensagem {
        width: 228px;
        height: 200px;
        padding: 5px;
        position: relative;
        cursor: pointer;
        border-radius: 20px;
        border: 2px solid #DADADA;
    }

    h1 {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-weight: 700;
        font-size: small;
        margin-left: 15px;
        margin-top: 15px;
    }

    #texto {
        display: inline-block;
        position: relative;
        padding-left: 15px;
        padding-right: 15px;
        padding-left: 15px;
        margin-top: 10px;
        height: 128px;
        max-width: 200px;
        font-family: Arial, Helvetica, sans-serif;
        font-weight: 200;
        font-size: medium;
        /* para cortar o texto*/
        text-overflow: ellipsis;
        overflow: hidden;

    }
</style>
<div>
    <div id="blocoMensagem" onclick="readCSVFile(target);">
        <h1><img src="icon.svg" alt=" ">&ensp;Ética do Servidor</h1>
        <p id="texto">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer.</p>
    </div>

</div>
<script>
    const target = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSHuOn8ktKO3l4rirMV_TjqSP7mOizvssdFFb6VMLcl4kIxNB44h6kJNmHEPM73qdCNT4huOKSM1oi/pub?gid=1648505482&single=true&output=tsv";


    const readCSVFile = async () => {

        try {
            const response = await fetch(target, {
                method: 'get',
                headers: {
                    'content-type': 'text/csv;charset=UTF-8',
                }
            })

            if (response.status === 200) {
                const data = await response.text();
                //console.log(data);
                getRandomMessage(data);
            } else {
                console.log(`Error code ${response.status}`);
            }
        } catch (err) {
            console.log(err)
        }

    }

    function randomIntFromInterval(min, max) { // min and max included 
        return Math.floor(Math.random() * (max - min + 1) + min)
    }

    function getRandomMessage(csvdata) {
        var rowData = csvdata.split('\n');
        var randomLine = randomIntFromInterval(2, rowData.length - 1);
        console.log("Linha escolhida: " + randomLine);

        let texto = rowData[randomLine].split('\t')[2];
        console.log("Texto: " + texto);
        var messageElement = document.getElementById('texto');
        messageElement.innerHTML = texto;
    }

    document.addEventListener("DOMContentLoaded", function () {
        readCSVFile();
    });

    setInterval(() => {
        readCSVFile();;
    }, 1000 * 60 * 5); // Executar a cada 5 minutos


</script>