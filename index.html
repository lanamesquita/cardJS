<!--
   Requisitos:
   - Criar um forms no GoogleForms para cadastrar as dicas de ética. Nesse cadastro tem um campo texto longo.
   - Investigar a quantidade de caracteres máximo do texto.
   - Criar um carrosel em html e javascript
   - Os textos devem ser atualizados a cada 2 minutos de forma randômica. Alterar a cor de fundo. Utilizar paleta com vários tons de azul.
   - Inserir carrosel na Intranet.
   -->
<meta charset="UTF-8">

<!-- CSS -->
<style type="text/css">
    table th,
    table td {
        padding: 5px;
    }

    #blocoMensagem {
        width: 228px;
        height: 170px;
        padding: 5px;
        position: relative;
        background: #ededed;
        display: flex;
        align-items: center; /* Vertical center alignment */
        justify-content: center; /* Horizontal center alignment */
    }

    #texto {
        display: inline-block;
        position: absolute;
        text-align: center;
        padding-left: 30px;
        padding-right: 30px;
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        font-weight: 200;
    }

    #imagem {
        width: 100%;
        height: 100%;
        opacity: 70%;
        position: absolute;
        top: 0;
        left: 0;
    }

    /*<li style="background: #0a2161"></li>
        <li style="background: #5c81e6"></li>
        <li style="background: #164ce0"></li>
        <li style="background: #192c61"></li>
        <li style="background: #113aad"></li>*/

</style>
<div>
    <div>
        <input type="button" id="btnsubmit" value="Submit" onclick="readCSVFile(target);">
    </div>
    <br><br>

    <div id="blocoMensagem">
        <img id="imagem" src="imagem.svg">
        <p id="texto">
            Entre um código de ética profissional, que me imporia a hipocrisia e minha liberdade de expressão e verdade da minha alma.
        </p>
    </div>


    <br><br>
    <!-- List CSV file data -->
    <table id="tblcsvdata" border="1" style="border-collapse: collapse;">
        <thead>
            <tr>
                <th>Data e hora</th>
                <th>e-mail do responsável</th>
                <th>Mensagem de ética</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<script>
    const target = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSHuOn8ktKO3l4rirMV_TjqSP7mOizvssdFFb6VMLcl4kIxNB44h6kJNmHEPM73qdCNT4huOKSM1oi/pub?gid=1648505482&single=true&output=tsv";


    const readCSVFile = async () => {

        try {
            const response = await fetch(target, {
                method: 'get',
                headers: {
                    'content-type': 'text/csv;charset=UTF-8',
                }
            })

            if (response.status === 200) {
                const data = await response.text();
                console.log(data);
                //getContent(data);
                getRounMessage(data);
            } else {
                console.log(`Error code ${response.status}`);
            }
        } catch (err) {
            console.log(err)
        }

    }

    function getRounMessage(csvdata) {
        var rowData = csvdata.split('\n');
        var randomLine = Math.floor(Math.random() * rowData.length);
        console.log("Linha escolhida: "+randomLine);

        let texto = rowData[randomLine].split('\t')[2];
        console.log("Texto: " + texto);
        var messageElement = document.getElementById('texto');
        messageElement.innerHTML = texto;
    }


    function getContent(csvdata) {
        var rowData = csvdata.split('\n');
        var tbodyEl = document.getElementById('tblcsvdata').getElementsByTagName('tbody')[0];
        tbodyEl.innerHTML = ""
        // Loop on the row Array (change row=0 if you also want to read 1st row)
        for (var row = 1; row < rowData.length; row++) {
            // Insert a row at the end of table
            var newRow = tbodyEl.insertRow();

            // Split by tabspace to get column Array
            rowColData = rowData[row].split('\t');

            // Loop on the row column Array
            for (var col = 0; col < rowColData.length; col++) {

                // Insert a cell at the end of the row
                var newCell = newRow.insertCell();
                newCell.innerHTML = rowColData[col];

            }
        }

    }


</script>